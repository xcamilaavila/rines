<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Personaliza tu Rin</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js"
    }
  }
  </script>

  <script type="module" src="script.js"></script>
</head>


<body>
<div class="app">
  <div class="top-image">
    <img src="models/imagenes/logo-reparllantashdsmall.png" alt="Logo principal" class="logo">
    <img src="models/imagenes/logo-diamantado.png" alt="Logo secundario" class="logo logo-secondary">
  </div>
</div>


  <!-- BOTÓN AR -->
<div class="ar-buttons">
  <button id="arBtn" class="ar-button">
    Visualizar Rin (AR)
  </button>

  <button id="changeRimBtn" class="secondary-button">
    Cambio Rin
  </button>
</div>


    

  <!-- VISOR AR (oculto) -->
<model-viewer
  id="arViewer"
  src="models/rin.glb"
  ar
  ar-modes="scene-viewer quick-look"
  camera-controls
  style="
    position: fixed;
    bottom: -1000px;
    width: 300px;
    height: 300px;
    opacity: 0;
    pointer-events: none;
  ">
</model-viewer>


    <main>
      <div id="viewer"></div>

<!-- Botones de colores -->
    <div class="controls-title">Colores disponibles</div>

      <div class="controls">
        
        <button data-finish="negro">Negro</button>
        <button data-finish="dorado">Dorado</button>
        <button data-finish="gris_claro">Gris claro</button>
        <button data-finish="aguamarina">Aguamarina</button>
        <button data-finish="dorado_verdoso">dorado v</button>
        <button data-finish="gris_2">gris 2</button>
        <button data-finish="gris_5">gris 5</button>
        <button data-finish="gris_7">gris 7</button>
        <button data-finish="gris_negro">gris negro</button>
        <button data-finish="gris_4">gris 4</button>
        <button data-finish="gris_azulado">gris azulado</button>
        <button data-finish="naranja">naranja</button>
        <button data-finish="gris_rata">gris rata</button>
        <button data-finish="gris_oscuro">gris oscuro</button>
        <button data-finish="gris_3">gris 3</button>
        <button data-finish="gris_6">gris 6</button>
        <button data-finish="gris_8">gris 8</button>
        
      </div>

    <!-- Boton de efecto -->
    <div class="controls-title">Efectos disponibles</div>
    <p class="hint">Doble click para diamantado total</p>


    <div class="controls effects">
      <button id="diamondBtn">Diamantado</button>
      <button id="clearBtn">Limpiar</button>
    </div>

    </main>
  </div>

 <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>



<script>
  // SOLO PARA AR
  window.arModelsByColor = {
  negro: "models/rin_negro.glb",
  dorado: "models/rin_dorado.glb",
  gris_claro: "models/rin_gris_claro.glb",
  aguamarina: "models/rin_aguamarina.glb",
  dorado_verdoso: "models/rin_dorado_verdoso.glb",
  gris_2: "models/rin_gris_2.glb",
  gris_5: "models/rin_gris_5.glb",
  gris_7: "models/rin_gris_7.glb",
  gris_negro: "models/rin_gris_negro.glb",
  gris_4: "models/rin_gris_4.glb",
  gris_azulado: "models/rin_gris_azulado.glb",
  naranja: "models/rin_naranja.glb",
  gris_rata: "models/rin_gris_rata.glb",
  gris_oscuro: "models/rin_gris_oscuro.glb",
  gris_3: "models/rin_gris_3.glb",
  gris_6: "models/rin_gris_6.glb",
  gris_8: "models/rin_gris_8.glb"

  };
</script>

 <!-- 2️⃣ TU SCRIPT AR -->
<script>
  const arBtn = document.getElementById("arBtn");
  const arViewer = document.getElementById("arViewer");

  customElements.whenDefined("model-viewer").then(() => {

    arBtn.addEventListener("click", async () => {

      const selectedColor = window.arConfig?.color;
      let modelSrc = "models/rin.glb";

      if (selectedColor && window.arModelsByColor[selectedColor]) {
        modelSrc = window.arModelsByColor[selectedColor];
      }

      console.log("AR model:", modelSrc);

      // 1️⃣ Cambiamos el modelo
      arViewer.src = modelSrc;

      // 2️⃣ Forzamos repaint + pequeño delay
      await new Promise(requestAnimationFrame);
      await new Promise(res => setTimeout(res, 150));

      // 3️⃣ Abrimos AR
      try {
        arViewer.activateAR();
      } catch (e) {
        alert("No se pudo abrir AR");
        console.error(e);
      }

    });

  });
</script>





</body>
</html>
